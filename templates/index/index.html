<html>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

            <script>
                updatePermalink  = function () {
                    let service = document.getElementById("services").value;
                    let organisme = document.getElementById("organismes").value;
                    let annee = document.getElementById("annees").value;
                    let permalink = `${this.document.location.origin}/mpublisher/${service}/${organisme}/${annee}`;
                    let link = document.getElementById('permalink');
                    let iframe = document.getElementById('iframe');
                    link.href = permalink;
                    link.text = permalink;
                    iframe.src = permalink;
                }
                </script>
    </head>
<body>
    <div class="main container-fluid">


<div class="row ">
    <div class="col">
        <nav class="navbar navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Générateur de Permaliens MPUBLISHER</a>
            </div>

          </nav>

          <div class="permalink">
            <a id="permalink" href="" target="_blank"></a>
        </div>

        <p>
            Sélectionner un service et un organisme pour générer le lien permanent d'accès au service
        </p>

        <div class="card">
            <div class="card-body">
                <label for="services" class="form-label">Services :</label>
                <select id="services" class="form-control" name="services" onchange=updatePermalink()>
                    {% for name, service in services %}
                        <option value="{{ name }}">{{ service.title }}</option>
                    {% endfor %}
                </select>
                </br>
                <label for="organismes" class="form-label">Organismes :</label>
                <select id="organismes" class="form-control" name="organismes" onchange=updatePermalink()>
                    {% for organisme in organismes %}
                        <option value="{{ organisme.properties.siren }}">{{ organisme.properties.organisme }}</option>
                    {% endfor %}
                </select>
                </br>
                <label for="annees" class="form-label">Années :</label>
                <select id="annees" class="form-control" name="annees" onchange=updatePermalink()>
                    {% for annee in annees %}
                        <option value="{{ annee }}">{{ annee }}</option>
                    {% endfor %}
                </select>
            </div>
          </div>



</div>
<div class="col">

<iframe id="iframe" src="" width="100%" height="100%"></iframe>
</div>
</div>
<style>
    html, body, .main, .row {
        height:100%;
    }
    .permalink, p {
        padding-top: 30px;
        padding-left: 30px;
        padding-bottom: 30px;
    }

    .card {
        margin-left: 30px;
    }

</style>
</div>

</body>
</html>